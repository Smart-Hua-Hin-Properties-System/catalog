<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SMART PROPERTIES SYSTEM</title>

  <style>
    :root{
      --bg:#9fb8dc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --primary:#0b4a78;
      --radius:24px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    /* ---------- Layout ---------- */
    .page{
      min-height:100svh;
      padding: 16px;
      display:flex;
      align-items:flex-start;
      justify-content:center;
    }
    .container{
      width:min(720px, 100%);
    }

    .topbar{
      display:flex;
      justify-content:flex-start;
      margin: 6px 0 14px;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 12px 16px;
      border-radius: 999px;
      border: 0;
      background: var(--primary);
      color:#fff;
      font-weight:700;
      cursor:pointer;
      text-decoration:none;
      box-shadow: 0 10px 20px rgba(0,0,0,.15);
      user-select:none;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{
      background:#0f2f48;
    }

    .card{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 20px 40px rgba(0,0,0,.15);
      padding: 18px;
      overflow:hidden;
    }

    h1{
      margin: 6px 0 12px;
      font-size: clamp(22px, 3.2vw, 34px);
      letter-spacing: .3px;
    }
    .subtitle{
      margin: 0 0 14px;
      color: var(--muted);
      font-weight:600;
    }

    /* ---------- Image ---------- */
    .hero{
      width:100%;
      aspect-ratio: 16/10;
      background:#e2e8f0;
      border-radius: 18px;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .hero img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    /* ---------- Info grid ---------- */
    .info{
      margin-top: 16px;
      display:grid;
      gap: 12px;
    }
    .row{
      display:flex;
      flex-wrap:wrap;
      gap: 10px 14px;
      align-items:center;
      font-size: 18px;
      line-height: 1.4;
    }
    .row strong{font-weight:800}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      background:#ecfeff;
      border:1px solid #a5f3fc;
      font-weight:800;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      background:#f1f5f9;
      border:1px solid #e2e8f0;
      font-weight:700;
      color:#0f172a;
    }

    /* ---------- Loader overlay ---------- */
    .overlay{
      position:fixed;
      inset:0;
      background: var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 20px;
      z-index: 9999;
    }
    .loaderBox{
      text-align:center;
      width:min(460px, 100%);
      padding: 18px;
    }
    .icons{
      font-size: 52px;
      display:flex;
      gap:14px;
      justify-content:center;
      margin-bottom: 10px;
      filter: drop-shadow(0 8px 14px rgba(0,0,0,.18));
    }
    .icons span{
      display:inline-block;
      animation: bounce 1.05s infinite ease-in-out;
      transform-origin: center bottom;
    }
    .icons span:nth-child(2){animation-delay:.12s}
    .icons span:nth-child(3){animation-delay:.24s}

    @keyframes bounce{
      0%,100%{transform:translateY(0) scale(1)}
      50%{transform:translateY(-10px) scale(1.03)}
    }

    .bigMsg{
      font-weight:900;
      color:#fff;
      letter-spacing:.6px;
      font-size: 20px;
      text-transform: uppercase;
      margin: 6px 0 6px;
      text-shadow: 0 8px 18px rgba(0,0,0,.25);
    }
    .smallMsg{
      margin:0;
      color: rgba(255,255,255,.86);
      font-weight:700;
      font-size: 14px;
    }

    .hidden{display:none !important}

    /* ---------- Mobile tweaks ---------- */
    @media (max-width: 420px){
      .card{padding: 14px}
      .row{font-size: 17px}
      .icons{font-size: 46px}
    }
  </style>
</head>

<body>
  <!-- LOADER -->
  <div id="overlay" class="overlay">
    <div class="loaderBox">
      <div class="icons" aria-hidden="true">
        <span>üè†</span><span>‚ú®</span><span>üå¥</span>
      </div>
      <div id="msg" class="bigMsg">SMART PROPERTIES SYSTEM</div>
      <p id="submsg" class="smallMsg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡πâ‡∏≤‡∏ô‚Ä¶</p>
    </div>
  </div>

  <!-- PAGE -->
  <div class="page">
    <div class="container">
      <div class="topbar">
        <a class="btn" href="./index.html">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      </div>

      <div class="card">
        <h1 id="codeTitle">CODE: -</h1>
        <div class="subtitle" id="projectLine">SMART PROPERTIES SYSTEM</div>

        <div class="hero">
          <img id="heroImg" alt="Property image" loading="eager" />
        </div>

        <div class="info" id="info">
          <div class="row"><span class="badge">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤: <strong id="price">-</strong></span></div>
          <div class="row"><span class="pill">üè° ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: <strong id="project">-</strong></span></div>
          <div class="row"><span class="pill">üìç ‡∏ó‡∏≥‡πÄ‡∏•: <strong id="location">-</strong></span></div>
          <div class="row">
            <span class="pill">üõèÔ∏è ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô: <strong id="bed">-</strong></span>
            <span class="pill">üõÅ ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥: <strong id="bath">-</strong></span>
          </div>
          <div class="row"><span class="pill">‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <strong id="status">-</strong></span></div>

          <div class="row" style="margin-top:6px; justify-content:flex-start; gap:10px;">
            <a id="mapBtn" class="btn secondary" href="#" target="_blank" rel="noopener">üåç ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</a>
            <a id="shareBtn" class="btn secondary" href="#" target="_blank" rel="noopener">üîó ‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡∏á‡∏Å‡πå</a>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/** =========================
 * CONFIG: ‡πÉ‡∏™‡πà URL Web App ‡∏Ç‡∏≠‡∏á Apps Script ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì Deploy ‡πÑ‡∏ß‡πâ
 * ========================= */
const API_URL = "https://script.google.com/macros/s/AKfycbzkweiEgczmmU_4FiqRffJ4exvgZl3RwGPIBWXssLgkUpdMArif9-eUEv6yP2Kvtzh1/exec"; 
// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤: https://script.google.com/macros/s/xxxxxxxxxxxx/exec

/** =========================
 * Helpers
 * ========================= */
function qs(name){
  return new URLSearchParams(location.search).get(name) || "";
}
function fmtMoney(n){
  const num = Number(String(n).replace(/,/g,""));
  if (!isFinite(num)) return String(n || "-");
  return num.toLocaleString("en-US");
}
function safeText(v){
  return (v===null || v===undefined || String(v).trim()==="") ? "-" : String(v);
}
function setLoading(isLoading, message, sub){
  const overlay = document.getElementById("overlay");
  const msg = document.getElementById("msg");
  const submsg = document.getElementById("submsg");
  if (message) msg.textContent = message;
  if (sub) submsg.textContent = sub;
  overlay.classList.toggle("hidden", !isLoading);
}

/** =========================
 * Render
 * ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö (‡∏Å‡∏±‡∏ô‡∏û‡∏±‡∏á)
 * ========================= */
function pick(obj, keys){
  for (const k of keys){
    if (obj && obj[k] !== undefined && obj[k] !== null && String(obj[k]).trim() !== "") return obj[k];
  }
  return "";
}

function render(item){
  const code = pick(item, ["ID","Code","CODE","HouseCode","HOUSE_CODE"]);
  const hpId = pick(item, ["HP_ID","hp_id"]);
  const price = pick(item, ["PRICE","Price","‡∏£‡∏≤‡∏Ñ‡∏≤"]);
  const project = pick(item, ["PROJECT","Project","‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"]);
  const amphoe = pick(item, ["AMPHOE","Amphoe","‡∏≠‡∏≥‡πÄ‡∏†‡∏≠"]);
  const tambon = pick(item, ["TAMBON","Tambon","‡∏ï‡∏≥‡∏ö‡∏•"]);
  const bed = pick(item, ["BEDROOMS","Bedrooms","‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô"]);
  const bath = pick(item, ["BATHROOMS","Bathrooms","‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥"]);
  const status = pick(item, ["STATUS","Status","‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"]);
  const img = pick(item, ["IMAGE","Image","MAIN_IMAGE","IMAGE_URL","photo","img"]);
  const map = pick(item, ["MAP","Map","GOOGLE_MAP","MAP_URL","‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà"]);

  document.getElementById("codeTitle").textContent = "CODE: " + (safeText(code) !== "-" ? code : safeText(hpId));
  document.getElementById("projectLine").textContent = "SMART PROPERTIES SYSTEM";

  document.getElementById("price").textContent = fmtMoney(price);
  document.getElementById("project").textContent = safeText(project);
  document.getElementById("location").textContent = safeText([amphoe, tambon].filter(Boolean).join(" / "));
  document.getElementById("bed").textContent = safeText(bed);
  document.getElementById("bath").textContent = safeText(bath);
  document.getElementById("status").textContent = safeText(status);

  const heroImg = document.getElementById("heroImg");
  heroImg.src = img || "https://via.placeholder.com/1200x800?text=NO+IMAGE";
  heroImg.onerror = () => {
    heroImg.src = "https://via.placeholder.com/1200x800?text=NO+IMAGE";
  };

  const mapBtn = document.getElementById("mapBtn");
  mapBtn.href = map || "https://www.google.com/maps";
  mapBtn.style.opacity = map ? "1" : ".65";
  mapBtn.style.pointerEvents = map ? "auto" : "none";

  const shareBtn = document.getElementById("shareBtn");
  shareBtn.href = location.href;
}

/** =========================
 * Fetch (‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô + ‡∏Å‡∏±‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á)
 * - sessionStorage cache
 * - timeout 12s
 * ========================= */
async function fetchDetailByHPID(hp_id){
  const cacheKey = "detail_" + hp_id;
  const cached = sessionStorage.getItem(cacheKey);
  if (cached){
    try { return JSON.parse(cached); } catch(e){}
  }

  const ctrl = new AbortController();
  const t = setTimeout(()=>ctrl.abort(), 12000);

  const url = `${API_URL}?action=getOne&role=PUBLIC&hp_id=${encodeURIComponent(hp_id)}&ts=${Date.now()}`;
  const res = await fetch(url, { signal: ctrl.signal, cache: "no-store" });
  clearTimeout(t);

  if (!res.ok) throw new Error("HTTP " + res.status);
  const data = await res.json();

  sessionStorage.setItem(cacheKey, JSON.stringify(data));
  return data;
}

/** =========================
 * Main
 * ========================= */
(async function init(){
  const id = qs("id").trim(); // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: HP-0003
  document.title = "SMART PROPERTIES SYSTEM";

  if (!API_URL || API_URL.includes("PASTE_YOUR_APPS_SCRIPT_WEBAPP_URL_HERE")){
    setLoading(true, "SMART PROPERTIES SYSTEM", "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API_URL ‡πÉ‡∏ô details.html");
    return;
  }

  if (!id){
    setLoading(true, "SMART PROPERTIES SYSTEM", "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡πà‡∏≤ id ‡πÉ‡∏ô URL ‡πÄ‡∏ä‡πà‡∏ô ?id=HP-0003");
    return;
  }

  try{
    setLoading(true, "SMART PROPERTIES SYSTEM", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡πâ‡∏≤‡∏ô‚Ä¶");

    const data = await fetchDetailByHPID(id);

    // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö response ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
    // { success:true, item:{...} }
    // { item:{...} }
    // { success:true, data:{...} }
    const item = data?.item || data?.data || data;

    if (!item || (data?.success === false)){
      setLoading(true, "SMART PROPERTIES SYSTEM", "PROPERTY NOT FOUND");
      return;
    }

    render(item);
    setLoading(false);

  }catch(err){
    console.error(err);
    setLoading(true, "SMART PROPERTIES SYSTEM", "‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ï‡∏£‡∏ß‡∏à API_URL / ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Web App / ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå HP_ID)");
  }
})();
</script>
</body>
</html>
