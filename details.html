<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Details | SMART SYSTEM</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Kanit',sans-serif; background:#9CBCE3; margin:0; overflow-x:hidden; width:100%; }
    #loader { height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; text-align:center; }
    .detail-card { background:white; width:92%; max-width:650px; margin:20px auto; border-radius:40px; padding:25px; display:none; box-shadow:0 10px 40px rgba(0,0,0,0.2); }
    .img { width:100%; border-radius:20px; margin:15px 0; object-fit:cover; }
    .back { background:#1a5276; color:white; border:none; padding:10px 25px; border-radius:50px; cursor:pointer; margin-bottom:20px; }
  </style>
</head>
<body>

<div id="loader">
  <div style="font-size:60px;">üè† ‚ú® üå¥</div>
  <h2 id="msg">FETCHING DETAILS...</h2>
</div>

<div id="ui" class="detail-card">
  <button class="back" onclick="history.back()">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
  <div id="content"></div>
</div>

<script>
  const api = "https://script.google.com/macros/s/AKfycbzkweiEgczmmU_4FiqRffJ4exvgZl3RwGPIBWXssLgkUpdMArif9-eUEv6yP2Kvtzh1/exec";

  function imgUrl(url){
    if(!url) return "https://placehold.co/600x800";
    if(url.includes("lh3.googleusercontent.com/d/")) return url;
    if(url.includes("id=")){
      const id = url.split("id=")[1].split("&")[0];
      return "https://lh3.googleusercontent.com/d/" + id;
    }
    return url;
  }

  async function load(){
    const id = new URLSearchParams(window.location.search).get('id');
    if(!id){
      document.getElementById('msg').innerText = "‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
      return;
    }

    try{
      const res = await fetch(`${api}?role=PUBLIC`);
      const data = await res.json();

      const item = data.find(it => String(it.HP_ID||"").trim() === String(id).trim());

      if(!item){
        document.getElementById('msg').innerText = "PROPERTY NOT FOUND";
        return;
      }

      document.getElementById('loader').style.display = "none";
      document.getElementById('ui').style.display = "block";

      document.getElementById('content').innerHTML = `
        <h2 style="color:#1a5276; margin:0;">CODE: ${item.ID || "-"}</h2>
        <img class="img" src="${imgUrl(item.Thumbnail)}" onerror="this.src='https://placehold.co/600x800'">
        <div style="font-size:1.05rem; line-height:1.9;">
          <p>üí∞ <b>‡∏£‡∏≤‡∏Ñ‡∏≤:</b> ‡∏ø${Number(item.Price||0).toLocaleString()}</p>
          <p>üè° <b>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</b> ${item.Project_Name || "-"}</p>
          <p>üìç <b>‡∏ó‡∏≥‡πÄ‡∏•:</b> ${item.District || "-"} / ${item.SubDistrict || "-"}</p>
          <p>üõå <b>‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô:</b> ${item.Bedrooms || "-"}</p>
          <p>‚úÖ <b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> ${item.Status || "-"}</p>
        </div>
      `;
    }catch(e){
      document.getElementById('msg').innerText = "ERROR LOADING DATA";
    }
  }

  window.onload = load;
</script>
</body>
</html>
