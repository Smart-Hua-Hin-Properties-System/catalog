<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>SMART PROPERTIES SYSTEM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #a9c3e5;
      --card: #ffffff;
      --primary: #1a4361;
      --accent: #1e88e5;
    }

    * {
      box-sizing: border-box;
      font-family: 'Kanit', sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
    }

    header {
      padding: 16px 24px;
      font-size: 20px;
      font-weight: 600;
      color: var(--primary);
    }

    /* FILTER BAR */
    .filters {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      padding: 0 24px 20px;
    }

    select {
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      font-size: 15px;
    }

    /* GRID */
    .grid {
      padding: 0 24px 40px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
    }

    .card {
      background: var(--card);
      border-radius: 22px;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: column;
    }

    .card img {
      width: 100%;
      height: 190px;
      object-fit: cover;
      background: #eee;
    }

    .card-body {
      padding: 14px 16px 18px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .code {
      font-weight: 600;
      font-size: 16px;
    }

    .project {
      font-size: 14px;
      color: #666;
      margin-top: 2px;
    }

    .price {
      margin: 10px 0 14px;
      font-size: 18px;
      font-weight: 600;
      color: var(--primary);
    }

    .btn {
      margin-top: auto;
      padding: 10px;
      border-radius: 30px;
      border: none;
      background: var(--primary);
      color: #fff;
      font-size: 15px;
      cursor: pointer;
    }

    .btn:hover {
      background: var(--accent);
    }

    @media (max-width: 768px) {
      .filters {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>

<header>SMART PROPERTIES SYSTEM</header>

<!-- FILTER BAR -->
<div class="filters">
  <select id="districtFilter">
    <option value="">อำเภอทั้งหมด</option>
  </select>

  <select id="subFilter">
    <option value="">ตำบลทั้งหมด</option>
  </select>

  <select id="bedFilter">
    <option value="">ห้องนอนทั้งหมด</option>
    <option value="2">2+</option>
    <option value="3">3+</option>
    <option value="4">4+</option>
  </select>

  <select id="sortFilter">
    <option value="">เรียงราคา</option>
    <option value="asc">น้อย → มาก</option>
    <option value="desc">มาก → น้อย</option>
  </select>
</div>

<!-- CARD GRID -->
<div class="grid" id="propertyGrid"></div>

<script>
const API_URL = "YOUR_APPS_SCRIPT_API_URL";

let allData = [];

fetch(API_URL)
  .then(r => r.json())
  .then(data => {
    allData = data;
    initFilters(data);
    render(data);
  });

function initFilters(data) {
  const district = [...new Set(data.map(d => d.District).filter(Boolean))];
  district.forEach(v => districtFilter.innerHTML += `<option>${v}</option>`);

  districtFilter.onchange = () => {
    subFilter.innerHTML = '<option value="">ตำบลทั้งหมด</option>';
    [...new Set(
      allData
        .filter(d => d.District === districtFilter.value)
        .map(d => d.SubDistrict)
    )].forEach(v => subFilter.innerHTML += `<option>${v}</option>`);
    apply();
  };

  [subFilter, bedFilter, sortFilter].forEach(el => el.onchange = apply);
}

function apply() {
  let list = [...allData];

  if (districtFilter.value)
    list = list.filter(d => d.District === districtFilter.value);

  if (subFilter.value)
    list = list.filter(d => d.SubDistrict === subFilter.value);

  if (bedFilter.value)
    list = list.filter(d => Number(d.Bedrooms) >= Number(bedFilter.value));

  if (sortFilter.value === "asc")
    list.sort((a,b)=>a.Price-b.Price);

  if (sortFilter.value === "desc")
    list.sort((a,b)=>b.Price-a.Price);

  render(list);
}

function render(data) {
  propertyGrid.innerHTML = "";
  data.forEach(d => {
    propertyGrid.innerHTML += `
      <div class="card">
        <img src="${d.Thumbnail || 'https://via.placeholder.com/400x300'}">
        <div class="card-body">
          <div class="code">${d.HOUSE_ID}</div>
          <div class="project">${d.Project_Name}</div>
          <div class="price">฿${Number(d.Price).toLocaleString()}</div>
          <button class="btn" onclick="go('${d.HP_ID}')">ดูรายละเอียด</button>
        </div>
      </div>
    `;
  });
}

function go(id){
  location.href = `details.html?id=${id}`;
}
</script>

</body>
</html>
