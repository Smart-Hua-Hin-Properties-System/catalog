<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart-Hua Hin-Properties-System</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a5276; --bg: #f0f2f5; --white: #ffffff; --green: #27ae60; --text: #2c3e50; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; padding: 0; overflow-x: hidden; color: var(--text); }

        /* üì± Header & Navigation */
        header { 
            background: #fff; padding: 10px 15px; display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-left { display: flex; align-items: center; gap: 12px; }
        .menu-icon { font-size: 1.4rem; color: var(--primary); cursor: pointer; }
        .brand-name { font-weight: 600; font-size: 0.9rem; color: var(--primary); text-transform: uppercase; }
        .flag-list { display: flex; gap: 4px; }
        .flag-list img { width: 22px; height: 14px; border-radius: 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }

        /* üö™ Sidebar */
        .sidebar { position: fixed; left: -280px; top: 0; width: 280px; height: 100%; background: #fff; z-index: 2000; transition: 0.3s; padding-top: 60px; box-shadow: 5px 0 15px rgba(0,0,0,0.1); }
        .sidebar.active { left: 0; }
        .sidebar-item { padding: 15px 25px; border-bottom: 1px solid #f8f9fa; display: flex; align-items: center; gap: 15px; text-decoration: none; color: var(--text); font-weight: 300; }
        .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1500; }
        .sidebar-overlay.active { display: block; }

        /* üîç Filter Bar */
        .filter-section { background: var(--white); padding: 15px; margin: 10px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .filter-trigger { 
            width: 100%; padding: 12px; background: #fff; border: 1px solid #ddd; border-radius: 10px; 
            text-align: left; font-family: 'Kanit'; font-size: 0.9rem; color: var(--primary); display: flex; justify-content: space-between; align-items: center; cursor: pointer;
        }
        .filter-sub-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        select { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ddd; font-family: 'Kanit'; color: var(--primary); outline: none; font-size: 0.85rem; }

        /* üèóÔ∏è ID Selection Modal (Upgraded) */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 3000; align-items: center; justify-content: center; padding: 15px; }
        .modal.active { display: flex; }
        .modal-content { background: #fff; width: 100%; max-width: 500px; border-radius: 20px; overflow: hidden; max-height: 85vh; display: flex; flex-direction: column; }
        .modal-header { padding: 15px 20px; background: #fff; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { overflow-y: auto; padding: 5px 0; }
        .id-row { 
            display: flex; flex-direction: column; padding: 12px 18px; border-bottom: 1px solid #f8f9fa; cursor: pointer; transition: 0.2s;
        }
        .id-row:active { background: #f0f7ff; }
        .id-row-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        .id-name { font-weight: 600; color: var(--primary); font-size: 1.05rem; }
        .id-price { font-weight: 600; color: var(--primary); font-size: 0.95rem; }
        .id-row-bottom { display: flex; justify-content: space-between; align-items: center; font-size: 0.78rem; color: #7f8c8d; }
        .id-details { display: flex; gap: 8px; flex-wrap: wrap; }
        .status-text { font-weight: 600; }
        .btn-clear { color: #e74c3c; font-size: 0.85rem; border: none; background: none; cursor: pointer; font-family: 'Kanit'; }

        /* üè† Cards Grid */
        .property-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px; padding: 10px; }
        .card { background: var(--white); border-radius: 20px; overflow: hidden; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.04); }
        .card-img-box { position: relative; height: 220px; cursor: pointer; }
        .card-img { width: 100%; height: 100%; object-fit: cover; }
        .badge { 
            position: absolute; top: 12px; left: 12px; background: var(--green); color: white;
            padding: 5px 12px; border-radius: 50px; font-weight: 600; font-size: 0.75rem; box-shadow: 0 4px 10px rgba(0,0,0,0.15); z-index: 5;
        }
        .card-body { padding: 15px; }
        .card-price { font-size: 1.4rem; font-weight: 600; color: var(--primary); margin: 5px 0; }
        .card-meta { display: flex; gap: 10px; font-size: 0.8rem; color: #7f8c8d; margin-top: 10px; }
        .status-pill { font-size: 0.7rem; background: #e8f5e9; color: var(--green); padding: 2px 8px; border-radius: 4px; font-weight: 600; }
        .btn-detail { display: block; width: 100%; padding: 12px; background: var(--primary); color: white; text-align: center; text-decoration: none; border-radius: 12px; font-weight: 600; margin-top: 15px; }

        #loading { text-align: center; padding: 100px; color: var(--primary); }
    </style>
</head>
<body>

<header>
    <div class="header-left">
        <div class="menu-icon" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
        <div class="brand-name" id="brandDisplay">Smart System</div>
    </div>
    <div class="flag-list">
        <img src="https://flagcdn.com/w40/th.png"><img src="https://flagcdn.com/w40/us.png"><img src="https://flagcdn.com/w40/cn.png"><img src="https://flagcdn.com/w40/ru.png"><img src="https://flagcdn.com/w40/de.png"><img src="https://flagcdn.com/w40/fr.png">
    </div>
</header>

<div class="sidebar-overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
    <a href="#" class="sidebar-item"><i class="fas fa-home"></i> Home</a>
    <a href="#" class="sidebar-item"><i class="fas fa-th-list"></i> All Projects</a>
    <a href="#" class="sidebar-item"><i class="fas fa-heart"></i> Favorites</a>
    <a href="#" class="sidebar-item"><i class="fas fa-phone"></i> Contact</a>
</div>

<div class="filter-section">
    <button class="filter-trigger" onclick="toggleModal(true)">
        <span id="selectedIdText">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏õ‡∏•‡∏á/‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£...</span>
        <i class="fas fa-chevron-down"></i>
    </button>
    <div class="filter-sub-grid">
        <select id="bedFilter" onchange="applyFilters()">
            <option value="">‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô</option><option value="1">1 Bed</option><option value="2">2 Bed</option><option value="3">3 Bed</option><option value="4">4 Bed</option><option value="5">5 Bed</option><option value="6">6+ Bed</option>
        </select>
        <select id="sortFilter" onchange="applyFilters()">
            <option value="low">‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ô‡πâ‡∏≠‡∏¢ ‚Üí ‡∏°‡∏≤‡∏Å</option><option value="high">‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏°‡∏≤‡∏Å ‚Üí ‡∏ô‡πâ‡∏≠‡∏¢</option>
        </select>
    </div>
</div>

<div class="modal" id="idModal">
    <div class="modal-content">
        <div class="modal-header">
            <b style="font-size: 1rem;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</b>
            <button class="btn-clear" onclick="clearIdFilter()">‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</button>
        </div>
        <div class="modal-body" id="idList">
            </div>
        <div style="padding: 15px; text-align: center; border-top: 1px solid #eee;" onclick="toggleModal(false)">
            <b style="color: var(--primary); font-size: 0.9rem;">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</b>
        </div>
    </div>
</div>

<div id="loading"><i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö Smart Property...</div>
<div class="property-grid" id="grid"></div>

<script>
    const api = "https://script.google.com/macros/s/AKfycbytY48pBly91AAPJ4I6oy7QtuS451d-U5EKBvIwtobMQrty2Q3zsUw6P9LI3zm7Z4E7/exec";
    let rawData = [];
    let activeIdFilter = "";
    const params = new URLSearchParams(window.location.search);
    const currentProject = params.get('project') || "Smart Property";

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('active');
        document.querySelector('.sidebar-overlay').classList.toggle('active');
    }

    function toggleModal(show) {
        document.getElementById('idModal').classList.toggle('active', show);
    }

    async function init() {
        try {
            const res = await fetch(api);
            rawData = await res.json();
            document.getElementById('brandDisplay').innerText = currentProject;
            buildIdModal();
            applyFilters();
        } catch (e) { document.getElementById('loading').innerText = "‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß"; }
    }

    function buildIdModal() {
        const list = document.getElementById('idList');
        // ‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ID ‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        const projectData = rawData.filter(it => it.Project_Name && it.Project_Name.trim().toLowerCase() === currentProject.trim().toLowerCase());
        
        list.innerHTML = "";
        projectData.forEach(it => {
            const row = document.createElement('div');
            row.className = 'id-row';
            const fPrice = Number(it.Price).toLocaleString();
            const land = it['Land Area (sq.w)'] || 0;
            const living = it['Living Area (sq.m)'] || 0;
            const statusColor = it.Status === 'Sold' ? '#e74c3c' : (it.Status === 'Pending' ? '#f39c12' : '#27ae60');

            row.onclick = () => selectId(it.ID);
            row.innerHTML = `
                <div class="id-row-top">
                    <span class="id-name">${it.ID}</span>
                    <span class="id-price">‡∏ø${fPrice}</span>
                </div>
                <div class="id-row-bottom">
                    <div class="id-details">
                        <span><i class="fas fa-bed"></i> ${it.Bedrooms || 0} Bed</span>
                        <span><i class="fas fa-expand-arrows-alt"></i> ${land} sq.w</span>
                        <span><i class="fas fa-vector-square"></i> ${living} m¬≤</span>
                    </div>
                    <span class="status-text" style="color: ${statusColor}">${it.Status || 'Available'}</span>
                </div>
            `;
            list.appendChild(row);
        });
    }

    function selectId(id) {
        activeIdFilter = id;
        document.getElementById('selectedIdText').innerText = "‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: " + id;
        toggleModal(false);
        applyFilters();
    }

    function clearIdFilter() {
        activeIdFilter = "";
        document.getElementById('selectedIdText').innerText = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏õ‡∏•‡∏á/‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£...";
        toggleModal(false);
        applyFilters();
    }

    function applyFilters() {
        let filtered = rawData.filter(it => it.Project_Name && it.Project_Name.trim().toLowerCase() === currentProject.trim().toLowerCase());
        
        if (activeIdFilter) filtered = filtered.filter(it => it.ID === activeIdFilter);
        
        const bed = document.getElementById('bedFilter').value;
        if (bed) {
            if (bed === "6") filtered = filtered.filter(it => parseInt(it.Bedrooms) >= 6);
            else filtered = filtered.filter(it => parseInt(it.Bedrooms) === parseInt(bed));
        }

        const sort = document.getElementById('sortFilter').value;
        filtered.sort((a, b) => sort === "low" ? a.Price - b.Price : b.Price - a.Price);

        render(filtered);
    }

    function render(items) {
        const grid = document.getElementById('grid');
        document.getElementById('loading').style.display = 'none';
        grid.innerHTML = "";
        if (!items.length) { grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:50px; color:#999;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ô‡∏µ‡πâ</div>`; return; }

        items.forEach(it => {
            const card = document.createElement('div');
            card.className = 'card';
            const detailUrl = 'details.html?id=' + it.HP_ID;
            card.innerHTML = `
                <div class="card-img-box" onclick="window.location.href='${detailUrl}'">
                    <div class="badge">${it.HP_ID} - ${it.ID}</div>
                    <img src="${it.Thumbnail}" class="card-img" onerror="this.src='https://placehold.co/600x400?text=Smart+System'">
                </div>
                <div class="card-body">
                    <span class="status-pill">${it.Status || 'Available'}</span>
                    <div class="card-price">‡∏ø${Number(it.Price).toLocaleString()}</div>
                    <div class="card-meta">
                        <span><i class="fas fa-bed"></i> ${it.Bedrooms || 0}</span>
                        <span><i class="fas fa-expand-arrows-alt"></i> ${it['Land Area (sq.w)'] || 0}</span>
                        <span><i class="fas fa-vector-square"></i> ${it['Living Area (sq.m)'] || 0} m¬≤</span>
                    </div>
                    <a href="${detailUrl}" class="btn-detail">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
                </div>`;
            grid.appendChild(card);
        });
    }
    init();
</script>
</body>
</html>
