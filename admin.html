<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN | SMART PROPERTIES SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a5276; --bg: #9fb8dc; --white: #ffffff; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        
        /* üîí Login Box */
        .login-card { background: white; padding: 40px; border-radius: 35px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); width: 100%; max-width: 350px; text-align: center; }
        .pin-input { width: 100%; padding: 15px; font-size: 24px; text-align: center; border-radius: 15px; border: 2px solid #eee; letter-spacing: 10px; margin: 20px 0; outline: none; }
        
        /* üìä Dashboard (Hidden by Default) */
        #adminDashboard { display: none; background: #f4f7f6; width: 100vw; height: 100vh; overflow-y: auto; position: fixed; inset: 0; padding: 20px; box-sizing: border-box; }
        .container { max-width: 800px; margin: 0 auto; }
        .admin-card { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        
        /* UI Elements */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; color: var(--primary); }
        input, select, textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; font-family: 'Kanit'; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border-radius: 15px; border: none; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-logout { background: #e74c3c; color: white; margin-top: 10px; padding: 10px; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="login-card" id="loginSection">
        <div style="font-size: 50px;">üõ°Ô∏è</div>
        <h2 style="color: var(--primary);">AGENT LOGIN</h2>
        <p style="color: #888; font-size: 0.9rem;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN ‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô</p>
        <input type="password" id="pinInput" class="pin-input" maxlength="6" placeholder="******">
        <button class="btn btn-primary" onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <div id="loginMsg" style="margin-top:15px; color:red; font-size:0.8rem;"></div>
    </div>

    <div id="adminDashboard">
        <div class="container">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="color: var(--primary); margin:0;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</h2>
                <button class="btn-logout btn" onclick="location.reload()" style="width:auto;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>

            <div class="admin-card">
                <form id="propertyForm">
                    <div class="form-group">
                        <label>‡∏£‡∏´‡∏±‡∏™‡∏£‡∏∞‡∏ö‡∏ö (HP_ID)</label>
                        <input type="text" id="HP_ID" readonly placeholder="‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥" style="background:#eee;">
                    </div>
                    <div class="form-group">
                        <label>‡∏£‡∏´‡∏±‡∏™‡∏ö‡πâ‡∏≤‡∏ô / ‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏á (HOUSE_ID)</label>
                        <input type="text" id="HOUSE_ID" required placeholder="‡πÄ‡∏ä‡πà‡∏ô M16">
                    </div>
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label>
                        <input type="text" id="Project_Name" required>
                    </div>
                    <div class="form-group">
                        <label>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="Price" required>
                    </div>
                    <div class="form-group">
                        <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Thumbnail)</label>
                        <input type="text" id="Thumbnail" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏≤‡∏Å Google Drive">
                    </div>
                    <div class="form-group">
                        <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label>
                        <select id="District">
                            <option value="‡∏´‡∏±‡∏ß‡∏´‡∏¥‡∏ô">‡∏´‡∏±‡∏ß‡∏´‡∏¥‡∏ô</option>
                            <option value="‡∏ä‡∏∞‡∏≠‡∏≥">‡∏ä‡∏∞‡∏≠‡∏≥</option>
                            <option value="‡∏õ‡∏£‡∏≤‡∏ì‡∏ö‡∏∏‡∏£‡∏µ">‡∏õ‡∏£‡∏≤‡∏ì‡∏ö‡∏∏‡∏£‡∏µ</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </form>
                <div id="saveMsg" style="margin-top:15px; text-align:center; font-weight:500;"></div>
            </div>
        </div>
    </div>

<script>
    // üö© ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏Ç‡∏≠‡∏á Apps Script ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì Deploy ‡πÉ‡∏´‡∏°‡πà (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å)
    const API_URL = "https://script.google.com/macros/s/AKfycbyS8rGtSnhVS8RdWje7icXZVCw5iBBJoWkEpOYm649OC6FOhnrVi87dD9GsJl_m_FVw/exec";

    /** üîí ‡∏£‡∏∞‡∏ö‡∏ö LOGIN */
    async function handleLogin() {
        const pin = document.getElementById('pinInput').value;
        if (!pin) return;

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: "login", pin: pin })
            });
            const data = await res.json();

            if (data.success) {
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('adminDashboard').style.display = 'block';
                document.body.style.background = "#f4f7f6";
            } else {
                document.getElementById('loginMsg').innerText = data.message;
            }
        } catch (e) {
            document.getElementById('loginMsg').innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠";
        }
    }

    /** üíæ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
    document.getElementById('propertyForm').onsubmit = async (e) => {
        e.preventDefault();
        const saveMsg = document.getElementById('saveMsg');
        saveMsg.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";
        
        const payload = {
            action: "save",
            HP_ID: document.getElementById('HP_ID').value,
            HOUSE_ID: document.getElementById('HOUSE_ID').value,
            Project_Name: document.getElementById('Project_Name').value,
            Price: document.getElementById('Price').value,
            Thumbnail: document.getElementById('Thumbnail').value,
            District: document.getElementById('District').value,
            Status: "Available"
        };

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify(payload)
            });
            const result = await res.json();
            if (result.success) {
                saveMsg.innerText = "‚úÖ " + result.message;
                if(result.newId) document.getElementById('HP_ID').value = result.newId;
            }
        } catch (e) {
            saveMsg.innerText = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å";
        }
    };
</script>
</body>
</html>
