<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN ACCESS | SMART PROPERTIES SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a5276; --bg: #9fb8dc; --white: #ffffff; --navy: #154360; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; overflow-x: hidden; }

        /* üîí Login UI */
        .login-box { background: white; padding: 40px; border-radius: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 90%; max-width: 420px; text-align: center; }
        
        /* ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏ß‡∏á‡∏ï‡∏≤ */
        .pin-wrapper { position: relative; margin: 25px 0; }
        .pin-field { 
            width: 100%; padding: 15px 50px 15px 15px; font-size: 28px; text-align: center; 
            border: 2px solid #eee; border-radius: 20px; letter-spacing: 5px; outline: none; 
            background: #f9f9f9; box-sizing: border-box; transition: 0.3s;
        }
        .pin-field:focus { border-color: var(--primary); background: #fff; box-shadow: 0 0 0 4px rgba(26, 82, 118, 0.1); }
        
        .toggle-password { 
            position: absolute; right: 20px; top: 50%; transform: translateY(-50%); 
            cursor: pointer; color: #aaa; font-size: 1.2rem; transition: 0.3s; 
        }
        .toggle-password:hover { color: var(--primary); }

        /* üìä Dashboard UI (Hidden by default) */
        #dashboard { display: none; background: #f0f2f5; position: fixed; inset: 0; z-index: 10000; overflow-y: auto; padding: 20px; }
        .top-nav { background: var(--navy); color: white; padding: 15px 25px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .user-info img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid white; }
        
        /* Menu Grid */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .menu-card { background: white; padding: 25px; border-radius: 25px; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.05); cursor: pointer; transition: 0.3s; }
        .menu-card:hover { transform: translateY(-5px); background: var(--primary); color: white; }
        .menu-card i { font-size: 2.5rem; margin-bottom: 12px; }

        .btn { width: 100%; padding: 15px; border-radius: 20px; border: none; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-primary:active { transform: scale(0.98); }
        .btn-logout { background: #e74c3c; color: white; width: auto; padding: 8px 20px; font-size: 0.9rem; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="login-box" id="loginPortal">
        <div style="font-size: 60px;">üõ°Ô∏è</div>
        <h2 style="color: var(--primary); margin: 10px 0;">ADMIN ACCESS</h2>
        <p style="color: #666;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN 6 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
        
        <div class="pin-wrapper">
            <input type="password" id="pinInput" class="pin-field" maxlength="6" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <i class="fas fa-eye toggle-password" id="eyeIcon" onclick="togglePinVisibility()"></i>
        </div>
        
        <button class="btn btn-primary" id="loginBtn" onclick="doLogin()">
            <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        </button>
        <div id="errMsg" style="color: #e74c3c; margin-top: 15px; font-weight: 500;"></div>
    </div>

    <div id="dashboard">
        <div class="top-nav">
            <div class="user-info">
                <img id="userPhoto" src="" alt="Profile">
                <div>
                    <div id="userName" style="font-weight: 600; font-size: 1.1rem;">-</div>
                    <div id="userRole" style="font-size: 0.75rem; opacity: 0.8; text-transform: uppercase;">-</div>
                </div>
            </div>
            <button class="btn btn-logout" onclick="location.reload()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <div id="roleMenu" class="menu-grid">
            </div>
    </div>

<script>
    // üö© ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏Ç‡∏≠‡∏á Apps Script ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const API_URL = "https://script.google.com/macros/s/AKfycbyS8rGtSnhVS8RdWje7icXZVCw5iBBJoWkEpOYm649OC6FOhnrVi87dD9GsJl_m_FVw/exec";

    /** üëÅÔ∏è ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏î‡∏ß‡∏á‡∏ï‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏´‡∏±‡∏™ PIN */
    function togglePinVisibility() {
        const pinInput = document.getElementById('pinInput');
        const eyeIcon = document.getElementById('eyeIcon');
        
        if (pinInput.type === "password") {
            pinInput.type = "text";
            eyeIcon.classList.remove('fa-eye');
            eyeIcon.classList.add('fa-eye-slash');
        } else {
            pinInput.type = "password";
            eyeIcon.classList.remove('fa-eye-slash');
            eyeIcon.classList.add('fa-eye');
        }
    }

    /** üîí ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠ Login (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) */
    async function doLogin() {
        const pin = document.getElementById('pinInput').value;
        const errMsg = document.getElementById('errMsg');
        const btn = document.getElementById('loginBtn');

        if (pin.length < 6) {
            errMsg.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 6 ‡∏´‡∏•‡∏±‡∏Å";
            return;
        }

        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';
        errMsg.innerText = "";

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: "login", pin: pin })
            });
            const data = await res.json();

            if (data.success) {
                showDashboard(data.userData);
            } else {
                errMsg.innerText = data.message;
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            }
        } catch (e) {
            errMsg.innerText = "‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
        }
    }

    /** üìä ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á Dashboard ‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå */
    function showDashboard(user) {
        document.getElementById('loginPortal').classList.add('hidden');
        document.getElementById('dashboard').style.display = 'block';
        document.body.style.background = "#f0f2f5";

        document.getElementById('userName').innerText = user.name;
        document.getElementById('userRole').innerText = user.role + " | " + (user.project || "ALL");
        document.getElementById('userPhoto').src = user.photo;

        renderMenu(user.role);
    }

    function renderMenu(role) {
        const menu = document.getElementById('roleMenu');
        let items = "";
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏≤‡∏° Role ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≤ [cite: 2026-01-27]
        if (role === "SUPER_ADMIN") {
            items += createMenuItem("fas fa-database", "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");
            items += createMenuItem("fas fa-user-check", "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Agent");
            items += createMenuItem("fas fa-file-invoice-dollar", "‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô/‡∏ö‡∏±‡∏ç‡∏ä‡∏µ");
            items += createMenuItem("fas fa-chart-pie", "‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°");
        } else if (role === "PROJECT_ADMIN") {
            items += createMenuItem("fas fa-house-user", "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£");
            items += createMenuItem("fas fa-users", "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏°‡∏∏‡πà‡∏á‡∏´‡∏ß‡∏±‡∏á");
        } else {
            items += createMenuItem("fas fa-search", "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
            items += createMenuItem("fas fa-history", "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á");
        }
        menu.innerHTML = items;
    }

    function createMenuItem(icon, label) {
        return `
            <div class="menu-card" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á ${label}')">
                <i class="${icon}"></i>
                <div style="font-weight:500;">${label}</div>
            </div>`;
    }
</script>
</body>
</html>
