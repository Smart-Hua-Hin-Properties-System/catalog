<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN ACCESS | SMART PROPERTIES SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a5276; --bg: #9fb8dc; --white: #ffffff; --navy: #154360; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; overflow-x: hidden; }

        /* üîí Login UI */
        .login-box { background: white; padding: 40px; border-radius: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 90%; max-width: 380px; text-align: center; transition: 0.5s; }
        .pin-field { width: 100%; padding: 15px; font-size: 32px; text-align: center; border: 2px solid #eee; border-radius: 20px; letter-spacing: 8px; margin: 25px 0; outline: none; background: #f9f9f9; }
        .pin-field:focus { border-color: var(--primary); background: #fff; }

        /* üìä Dashboard UI (Hidden by default) */
        #dashboard { display: none; background: #f0f2f5; position: fixed; inset: 0; z-index: 10000; overflow-y: auto; padding: 20px; }
        .top-nav { background: var(--navy); color: white; padding: 15px 25px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .user-info img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid white; }
        
        /* Menu Grid based on Role */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .menu-card { background: white; padding: 25px; border-radius: 25px; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.05); cursor: pointer; transition: 0.3s; }
        .menu-card:hover { transform: translateY(-5px); background: var(--primary); color: white; }
        .menu-card i { font-size: 2.5rem; margin-bottom: 12px; }

        .btn { width: 100%; padding: 15px; border-radius: 20px; border: none; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-logout { background: #e74c3c; color: white; width: auto; padding: 8px 20px; font-size: 0.9rem; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="login-box" id="loginPortal">
        <div style="font-size: 60px;">üõ°Ô∏è</div>
        <h2 style="color: var(--primary); margin: 10px 0;">ADMIN ACCESS</h2>
        <p style="color: #666;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN 6 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
        
        <input type="password" id="pinInput" class="pin-field" maxlength="6" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        
        <button class="btn btn-primary" id="loginBtn" onclick="doLogin()">
            <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        </button>
        <div id="errMsg" style="color: #e74c3c; margin-top: 15px; font-weight: 500;"></div>
    </div>

    <div id="dashboard">
        <div class="top-nav">
            <div class="user-info">
                <img id="userPhoto" src="" alt="Profile">
                <div>
                    <div id="userName" style="font-weight: 600; font-size: 1.1rem;">-</div>
                    <div id="userRole" style="font-size: 0.75rem; opacity: 0.8; text-transform: uppercase;">-</div>
                </div>
            </div>
            <button class="btn btn-logout" onclick="location.reload()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <div id="roleMenu" class="menu-grid">
            </div>
    </div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyS8rGtSnhVS8RdWje7icXZVCw5iBBJoWkEpOYm649OC6FOhnrVi87dD9GsJl_m_FVw/exec";

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™ 6 ‡∏´‡∏•‡∏±‡∏Å (Auto Login)
    document.getElementById('pinInput').addEventListener('input', function(e) {
        if(this.value.length === 6) doLogin();
    });

    async function doLogin() {
        const pin = document.getElementById('pinInput').value;
        if(pin.length < 6) return;

        const btn = document.getElementById('loginBtn');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: "login", pin: pin })
            });
            const data = await res.json();

            if (data.success) {
                showDashboard(data.userData);
            } else {
                document.getElementById('errMsg').innerText = data.message;
                btn.disabled = false;
                btn.innerHTML = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            }
        } catch (e) {
            document.getElementById('errMsg').innerText = "‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á";
            btn.disabled = false;
        }
    }

    function showDashboard(user) {
        document.getElementById('loginPortal').classList.add('hidden');
        document.getElementById('dashboard').style.display = 'block';
        document.body.style.background = "#f0f2f5";

        document.getElementById('userName').innerText = user.name;
        document.getElementById('userRole').innerText = user.role + " | Access: " + user.project;
        document.getElementById('userPhoto').src = user.photo;

        renderMenu(user.role);
    }

    function renderMenu(role) {
        const menu = document.getElementById('roleMenu');
        let items = "";

        // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SUPER_ADMIN (‡∏î‡∏π‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á)
        if (role === "SUPER_ADMIN") {
            items += createMenuItem("fas fa-database", "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");
            items += createMenuItem("fas fa-users-cog", "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡∏°");
            items += createMenuItem("fas fa-chart-line", "‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°");
            items += createMenuItem("fas fa-file-invoice-dollar", "‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ");
        } 
        // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PROJECT_ADMIN
        else if (role === "PROJECT_ADMIN") {
            items += createMenuItem("fas fa-home", "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡πâ‡∏≤‡∏ô");
            items += createMenuItem("fas fa-user-friends", "‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤");
        }
        // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö FINANCE
        else if (role === "FINANCE") {
            items += createMenuItem("fas fa-wallet", "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞");
            items += createMenuItem("fas fa-history", "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°");
        }
        // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AGENT
        else if (role === "AGENT") {
            items += createMenuItem("fas fa-plus-circle", "‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á");
            items += createMenuItem("fas fa-id-card", "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡∏ô");
        }

        menu.innerHTML = items;
    }

    function createMenuItem(icon, label) {
        return `
            <div class="menu-card" onclick="alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö${label}')">
                <i class="${icon}"></i>
                <div style="font-weight:500;">${label}</div>
            </div>
        `;
    }
</script>
</body>
</html>
