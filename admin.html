<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN | SMART PROPERTIES SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a5276; --navy: #154360; --bg: #9fb8dc; --white: #ffffff; --green: #27ae60; --red: #e74c3c; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; min-height: 100vh; overflow-x: hidden; }

        /* üîí Login Portal */
        #loginPortal { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .login-box { background: white; padding: 45px; border-radius: 45px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 420px; text-align: center; }
        .pin-wrapper { position: relative; margin: 25px 0; }
        .pin-field { width: 100%; padding: 15px; font-size: 28px; text-align: center; border: 2px solid #eee; border-radius: 20px; letter-spacing: 5px; outline: none; background: #f9f9f9; box-sizing: border-box; }
        
        /* üìä Dashboard UI */
        #dashboard { display: none; background: #f0f2f5; position: fixed; inset: 0; z-index: 1000; overflow-y: auto; padding-bottom: 50px; }
        .top-nav { background: var(--navy); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1100; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .profile-banner { background: var(--primary); color: white; padding: 40px 20px; text-align: center; border-radius: 0 0 50px 50px; margin-bottom: 20px; }
        .profile-img { width: 110px; height: 110px; border-radius: 50%; border: 4px solid white; object-fit: cover; background: #eee; margin-bottom: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        .main-container { max-width: 700px; margin: 0 auto; padding: 0 15px; }
        .card { background: white; padding: 30px; border-radius: 35px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* Menu Grid */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .menu-btn { background: white; padding: 25px 15px; border-radius: 25px; text-align: center; border: 1.5px solid #f0f0f0; transition: 0.3s; cursor: pointer; }
        .menu-btn:hover { border-color: var(--primary); background: #f0f7ff; transform: translateY(-3px); }
        .menu-btn i { font-size: 2rem; color: var(--primary); margin-bottom: 10px; }

        /* Form Styling */
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        @media (max-width: 500px) { .form-row { grid-template-columns: 1fr; } }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.75rem; font-weight: 700; color: #888; text-transform: uppercase; margin-bottom: 5px; margin-left: 5px; }
        input { width: 100%; padding: 12px 15px; border-radius: 12px; border: 1.5px solid #eee; box-sizing: border-box; font-family: 'Kanit'; font-size: 0.95rem; }
        input[readonly] { background: #f9f9f9; color: #aaa; border-color: #f0f0f0; cursor: not-allowed; }
        
        .btn { width: 100%; padding: 16px; border-radius: 20px; border: none; font-weight: 600; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-logout { background: var(--red); color: white; width: auto; padding: 8px 18px; font-size: 0.85rem; }
    </style>
</head>
<body>

    <div id="loginPortal">
        <div class="login-box">
            <div style="font-size: 60px;">üõ°Ô∏è</div>
            <h2 style="color: var(--primary); margin-bottom: 5px;">ADMIN ACCESS</h2>
            <p style="color: #666; margin-bottom: 25px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN 6 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
            
            <div class="pin-wrapper">
                <input type="password" id="pinInput" class="pin-field" maxlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                <i class="fas fa-eye" style="position:absolute; right:20px; top:50%; transform:translateY(-50%); cursor:pointer; color:#ccc;" id="eyeBtn" onclick="togglePin()"></i>
            </div>
            
            <button class="btn btn-primary" id="loginBtn" onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <div id="loginMsg" style="color: var(--red); margin-top: 15px; font-weight: 500;"></div>
        </div>
    </div>

    <div id="dashboard">
        <div class="top-nav">
            <span style="font-weight: 900; letter-spacing: 1px;">SMART DASHBOARD</span>
            <button class="btn btn-logout" onclick="location.reload()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <div class="profile-banner">
            <img id="userPhoto" src="" class="profile-img">
            <h2 id="userName" style="margin: 5px 0;">-</h2>
            <div id="userRoleBadge" style="font-size: 0.8rem; text-transform: uppercase; opacity: 0.8;">-</div>
        </div>

        <div class="main-container">
            <h3 style="color: var(--navy);"><i class="fas fa-th-large"></i> ‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
            <div id="menuContainer" class="menu-grid"></div>

            <div class="card">
                <h3 style="color: var(--primary); margin-top: 0;"><i class="fas fa-user-edit"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h3>
                <form id="profileForm">
                    <div class="form-row">
                        <div class="form-group"><label>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (PIN)</label><input type="text" id="Agent_PIN" readonly></div>
                        <div class="form-group"><label>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Role)</label><input type="text" id="Role" readonly></div>
                    </div>
                    <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" id="Full_Name" required></div>
                    <div class="form-row">
                        <div class="form-group"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="text" id="Phone"></div>
                        <div class="form-group"><label>Line ID</label><input type="text" id="Line_ID"></div>
                    </div>
                    <div class="form-group"><label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label><input type="email" id="Email"></div>
                    
                    <h4 style="border-top: 1px solid #f0f0f0; padding-top: 20px; color: var(--navy);">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡∏ô)</h4>
                    <div class="form-group"><label>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</label><input type="text" id="Bank_Name"></div>
                    <div class="form-row">
                        <div class="form-group"><label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label><input type="text" id="Bank_Account_Number"></div>
                        <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label><input type="text" id="Bank_Account_Name"></div>
                    </div>

                    <div class="form-group"><label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (URL)</label><input type="text" id="Profile_Photo_URL" oninput="document.getElementById('userPhoto').src = this.value"></div>
                    
                    <button type="submit" class="btn btn-primary" id="saveBtn" style="margin-top: 10px;">
                        <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
                    </button>
                </form>
                <div id="saveStatus" style="text-align: center; margin-top: 15px; font-weight: 600;"></div>
            </div>
        </div>
    </div>

<script>
    const API_URL = "<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN | SMART PROPERTIES SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a5276; --navy: #154360; --bg: #9fb8dc; --white: #ffffff; --green: #27ae60; --red: #e74c3c; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; min-height: 100vh; overflow-x: hidden; }

        /* üîí Login Portal */
        #loginPortal { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .login-box { background: white; padding: 45px; border-radius: 45px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 420px; text-align: center; }
        .pin-wrapper { position: relative; margin: 25px 0; }
        .pin-field { width: 100%; padding: 15px; font-size: 28px; text-align: center; border: 2px solid #eee; border-radius: 20px; letter-spacing: 5px; outline: none; background: #f9f9f9; box-sizing: border-box; }
        
        /* üìä Dashboard UI */
        #dashboard { display: none; background: #f0f2f5; position: fixed; inset: 0; z-index: 1000; overflow-y: auto; padding-bottom: 50px; }
        .top-nav { background: var(--navy); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1100; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .profile-banner { background: var(--primary); color: white; padding: 40px 20px; text-align: center; border-radius: 0 0 50px 50px; margin-bottom: 20px; }
        .profile-img { width: 110px; height: 110px; border-radius: 50%; border: 4px solid white; object-fit: cover; background: #eee; margin-bottom: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        .main-container { max-width: 700px; margin: 0 auto; padding: 0 15px; }
        .card { background: white; padding: 30px; border-radius: 35px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* Menu Grid */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .menu-btn { background: white; padding: 25px 15px; border-radius: 25px; text-align: center; border: 1.5px solid #f0f0f0; transition: 0.3s; cursor: pointer; }
        .menu-btn:hover { border-color: var(--primary); background: #f0f7ff; transform: translateY(-3px); }
        .menu-btn i { font-size: 2rem; color: var(--primary); margin-bottom: 10px; }

        /* Form Styling */
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        @media (max-width: 500px) { .form-row { grid-template-columns: 1fr; } }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.75rem; font-weight: 700; color: #888; text-transform: uppercase; margin-bottom: 5px; margin-left: 5px; }
        input { width: 100%; padding: 12px 15px; border-radius: 12px; border: 1.5px solid #eee; box-sizing: border-box; font-family: 'Kanit'; font-size: 0.95rem; }
        input[readonly] { background: #f9f9f9; color: #aaa; border-color: #f0f0f0; cursor: not-allowed; }
        
        .btn { width: 100%; padding: 16px; border-radius: 20px; border: none; font-weight: 600; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-logout { background: var(--red); color: white; width: auto; padding: 8px 18px; font-size: 0.85rem; }
    </style>
</head>
<body>

    <div id="loginPortal">
        <div class="login-box">
            <div style="font-size: 60px;">üõ°Ô∏è</div>
            <h2 style="color: var(--primary); margin-bottom: 5px;">ADMIN ACCESS</h2>
            <p style="color: #666; margin-bottom: 25px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN 6 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
            
            <div class="pin-wrapper">
                <input type="password" id="pinInput" class="pin-field" maxlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                <i class="fas fa-eye" style="position:absolute; right:20px; top:50%; transform:translateY(-50%); cursor:pointer; color:#ccc;" id="eyeBtn" onclick="togglePin()"></i>
            </div>
            
            <button class="btn btn-primary" id="loginBtn" onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <div id="loginMsg" style="color: var(--red); margin-top: 15px; font-weight: 500;"></div>
        </div>
    </div>

    <div id="dashboard">
        <div class="top-nav">
            <span style="font-weight: 900; letter-spacing: 1px;">SMART DASHBOARD</span>
            <button class="btn btn-logout" onclick="location.reload()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <div class="profile-banner">
            <img id="userPhoto" src="" class="profile-img">
            <h2 id="userName" style="margin: 5px 0;">-</h2>
            <div id="userRoleBadge" style="font-size: 0.8rem; text-transform: uppercase; opacity: 0.8;">-</div>
        </div>

        <div class="main-container">
            <h3 style="color: var(--navy);"><i class="fas fa-th-large"></i> ‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
            <div id="menuContainer" class="menu-grid"></div>

            <div class="card">
                <h3 style="color: var(--primary); margin-top: 0;"><i class="fas fa-user-edit"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h3>
                <form id="profileForm">
                    <div class="form-row">
                        <div class="form-group"><label>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (PIN)</label><input type="text" id="Agent_PIN" readonly></div>
                        <div class="form-group"><label>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Role)</label><input type="text" id="Role" readonly></div>
                    </div>
                    <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" id="Full_Name" required></div>
                    <div class="form-row">
                        <div class="form-group"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="text" id="Phone"></div>
                        <div class="form-group"><label>Line ID</label><input type="text" id="Line_ID"></div>
                    </div>
                    <div class="form-group"><label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label><input type="email" id="Email"></div>
                    
                    <h4 style="border-top: 1px solid #f0f0f0; padding-top: 20px; color: var(--navy);">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡∏ô)</h4>
                    <div class="form-group"><label>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</label><input type="text" id="Bank_Name"></div>
                    <div class="form-row">
                        <div class="form-group"><label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label><input type="text" id="Bank_Account_Number"></div>
                        <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label><input type="text" id="Bank_Account_Name"></div>
                    </div>

                    <div class="form-group"><label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (URL)</label><input type="text" id="Profile_Photo_URL" oninput="document.getElementById('userPhoto').src = this.value"></div>
                    
                    <button type="submit" class="btn btn-primary" id="saveBtn" style="margin-top: 10px;">
                        <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
                    </button>
                </form>
                <div id="saveStatus" style="text-align: center; margin-top: 15px; font-weight: 600;"></div>
            </div>
        </div>
    </div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzkweiEgczmmU_4FiqRffJ4exvgZl3RwGPIBWXssLgkUpdMArif9-eUEv6yP2Kvtzh1/exec";
    let myProfile = null;

    function togglePin() {
        const pin = document.getElementById('pinInput');
        const eye = document.getElementById('eyeBtn');
        pin.type = pin.type === 'password' ? 'text' : 'password';
        eye.className = pin.type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
    }

    async function handleLogin() {
        const pin = document.getElementById('pinInput').value;
        const btn = document.getElementById('loginBtn');
        if (pin.length < 6) return;

        btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...';

        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: "login", pin: pin }) });
            const data = await res.json();
            if (data.success) {
                myProfile = data.profile;
                setupDashboard();
            } else {
                document.getElementById('loginMsg').innerText = data.message;
                btn.disabled = false; btn.innerHTML = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            }
        } catch (e) {
            document.getElementById('loginMsg').innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠";
            btn.disabled = false;
        }
    }

    function setupDashboard() {
        document.getElementById('loginPortal').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        
        // 1. ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Header
        document.getElementById('userName').innerText = myProfile.Full_Name;
        document.getElementById('userRoleBadge').innerText = myProfile.Role + " | ACCESS: " + myProfile.Project_Access;
        document.getElementById('userPhoto').src = myProfile.Profile_Photo_URL || "https://placehold.co/200x200?text=USER";

        // 2. ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
        for (let key in myProfile) {
            const el = document.getElementById(key);
            if (el) el.value = myProfile[key];
        }

        // 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏≤‡∏° Role [cite: 2026-01-27]
        renderMenu(myProfile.Role);
    }

    function renderMenu(role) {
        const container = document.getElementById('menuContainer');
        let html = "";
        
        if (role === "SUPER_ADMIN") {
            html += createMenuBtn("fas fa-database", "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");
            html += createMenuBtn("fas fa-users-cog", "‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô");
            html += createMenuBtn("fas fa-chart-line", "‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢");
            html += createMenuBtn("fas fa-receipt", "‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á");
        } else if (role === "PROJECT_ADMIN") {
            html += createMenuBtn("fas fa-home", "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£");
            html += createMenuBtn("fas fa-user-tag", "‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤");
        } else if (role === "OWNER") {
            html += createMenuBtn("fas fa-eye", "‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡πâ‡∏≤‡∏ô");
            html += createMenuBtn("fas fa-history", "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£");
        } else {
            html += createMenuBtn("fas fa-search", "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏á");
            html += createMenuBtn("fas fa-wallet", "‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏Ø");
        }
        container.innerHTML = html;
    }

    function createMenuBtn(icon, text) {
        return `<div class="menu-btn" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà: ${text}')"><i class="${icon}"></i><div>${text}</div></div>`;
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå [cite: 2026-01-27]
    document.getElementById('profileForm').onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('saveBtn');
        const status = document.getElementById('saveStatus');
        btn.disabled = true; status.style.color = "blue"; status.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";

        const formData = { action: "updateProfile" };
        const inputs = e.target.querySelectorAll('input');
        inputs.forEach(inp => formData[inp.id] = inp.value);

        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify(formData) });
            const data = await res.json();
            if (data.success) {
                status.style.color = "green"; status.innerText = "‚úÖ " + data.message;
                setTimeout(() => status.innerText = "", 3000);
            }
        } catch (e) {
            status.style.color = "red"; status.innerText = "‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
        }
        btn.disabled = false;
    };
</script>
</body>
</html>";
    let myProfile = null;

    function togglePin() {
        const pin = document.getElementById('pinInput');
        const eye = document.getElementById('eyeBtn');
        pin.type = pin.type === 'password' ? 'text' : 'password';
        eye.className = pin.type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
    }

    async function handleLogin() {
        const pin = document.getElementById('pinInput').value;
        const btn = document.getElementById('loginBtn');
        if (pin.length < 6) return;

        btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...';

        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: "login", pin: pin }) });
            const data = await res.json();
            if (data.success) {
                myProfile = data.profile;
                setupDashboard();
            } else {
                document.getElementById('loginMsg').innerText = data.message;
                btn.disabled = false; btn.innerHTML = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            }
        } catch (e) {
            document.getElementById('loginMsg').innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠";
            btn.disabled = false;
        }
    }

    function setupDashboard() {
        document.getElementById('loginPortal').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        
        // 1. ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Header
        document.getElementById('userName').innerText = myProfile.Full_Name;
        document.getElementById('userRoleBadge').innerText = myProfile.Role + " | ACCESS: " + myProfile.Project_Access;
        document.getElementById('userPhoto').src = myProfile.Profile_Photo_URL || "https://placehold.co/200x200?text=USER";

        // 2. ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
        for (let key in myProfile) {
            const el = document.getElementById(key);
            if (el) el.value = myProfile[key];
        }

        // 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏≤‡∏° Role [cite: 2026-01-27]
        renderMenu(myProfile.Role);
    }

    function renderMenu(role) {
        const container = document.getElementById('menuContainer');
        let html = "";
        
        if (role === "SUPER_ADMIN") {
            html += createMenuBtn("fas fa-database", "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");
            html += createMenuBtn("fas fa-users-cog", "‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô");
            html += createMenuBtn("fas fa-chart-line", "‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢");
            html += createMenuBtn("fas fa-receipt", "‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á");
        } else if (role === "PROJECT_ADMIN") {
            html += createMenuBtn("fas fa-home", "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£");
            html += createMenuBtn("fas fa-user-tag", "‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤");
        } else if (role === "OWNER") {
            html += createMenuBtn("fas fa-eye", "‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡πâ‡∏≤‡∏ô");
            html += createMenuBtn("fas fa-history", "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£");
        } else {
            html += createMenuBtn("fas fa-search", "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏á");
            html += createMenuBtn("fas fa-wallet", "‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏Ø");
        }
        container.innerHTML = html;
    }

    function createMenuBtn(icon, text) {
        return `<div class="menu-btn" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà: ${text}')"><i class="${icon}"></i><div>${text}</div></div>`;
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå [cite: 2026-01-27]
    document.getElementById('profileForm').onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('saveBtn');
        const status = document.getElementById('saveStatus');
        btn.disabled = true; status.style.color = "blue"; status.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";

        const formData = { action: "updateProfile" };
        const inputs = e.target.querySelectorAll('input');
        inputs.forEach(inp => formData[inp.id] = inp.value);

        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify(formData) });
            const data = await res.json();
            if (data.success) {
                status.style.color = "green"; status.innerText = "‚úÖ " + data.message;
                setTimeout(() => status.innerText = "", 3000);
            }
        } catch (e) {
            status.style.color = "red"; status.innerText = "‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
        }
        btn.disabled = false;
    };
</script>
</body>
</html>
