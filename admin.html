<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART CONTROL | MASTER ADMIN V45.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --navy-header: #1a4361; --pill-gray: #5d7a8c; --red-logout: #e74c3c;
            --gold-bg: #fff3cd; --gold-border: #ffeeba; --gold-btn: #856404;
            --action-blue: #1a5276; --white: #ffffff; --text-dark: #2c3e50;
        }
        body { font-family: 'Kanit', sans-serif; background: #f0f3f5; margin: 0; color: var(--text-dark); }
        
        /* üîµ Navbar ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 1 */
        header { background: var(--navy-header); height: 65px; padding: 0 30px; display: flex; justify-content: space-between; align-items: center; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .h-left { display: flex; align-items: center; gap: 12px; font-weight: 600; font-size: 1.2rem; letter-spacing: 0.5px; }
        .master-badge { background: var(--pill-gray); padding: 3px 12px; border-radius: 50px; font-size: 0.7rem; font-weight: 500; text-transform: uppercase; }
        .logout-btn { background: var(--red-logout); border: none; color: white; padding: 8px 20px; border-radius: 8px; font-family: 'Kanit'; font-weight: 500; cursor: pointer; transition: 0.3s; }
        .logout-btn:hover { background: #c0392b; transform: scale(1.05); }

        .container { max-width: 900px; margin: 40px auto; padding: 0 20px; }
        h2 { color: var(--navy-header); font-weight: 500; font-size: 2rem; margin-bottom: 35px; }

        /* üëë ‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡∏ó‡∏≠‡∏á "‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏•‡∏±‡∏ö" ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì */
        .executive-section { background: var(--gold-bg); border: 2px solid var(--gold-border); border-radius: 18px; padding: 28px; margin-bottom: 30px; box-shadow: 0 10px 20px rgba(133,100,4,0.1); transition: 0.4s; }
        .executive-section:hover { transform: translateY(-3px); box-shadow: 0 12px 25px rgba(133,100,4,0.15); }
        .gold-label { color: #856404; font-weight: 600; font-size: 1.2rem; text-align: center; margin-bottom: 18px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-gold { background: var(--gold-btn); color: white; width: 100%; max-width: 580px; margin: 0 auto; padding: 18px; border-radius: 15px; border: none; font-family: 'Kanit'; font-size: 1.15rem; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; text-decoration: none; transition: 0.3s; box-shadow: 0 6px 15px rgba(133,100,4,0.3); }
        .btn-gold:hover { background: #6e5303; box-shadow: 0 8px 20px rgba(133,100,4,0.4); }

        /* ‚ûï ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô */
        .btn-add { background: var(--action-blue); color: white; width: 100%; padding: 22px; border-radius: 15px; border: none; font-family: 'Kanit'; font-size: 1.3rem; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 30px; box-shadow: 0 10px 25px rgba(26, 82, 118, 0.2); transition: 0.3s; }
        .btn-add:hover { background: #154360; transform: translateY(-2px); box-shadow: 0 12px 30px rgba(26, 82, 118, 0.3); }

        /* üîç ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ */
        .search-wrapper { background: white; border-radius: 15px; padding: 18px 25px; margin-bottom: 30px; border: 1px solid #ddd; display: flex; align-items: center; gap: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .search-wrapper input { border: none; outline: none; width: 100%; font-family: 'Kanit'; font-size: 1.1rem; color: var(--text-dark); }

        /* ‚ö™ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å */
        .main-data-card { background: white; border-radius: 30px; padding: 70px 40px; border: 1px solid #eee; box-shadow: 0 15px 45px rgba(0,0,0,0.05); min-height: 300px; text-align: center; }
        .loading-state i { color: var(--navy-header); margin-bottom: 25px; filter: drop-shadow(0 4px 8px rgba(26,67,97,0.2)); }
        
        .property-row { text-align: left; padding: 25px; border-bottom: 1px solid #f2f4f7; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; }
        .property-row:hover { background: #f8fbff; }
        .property-row:last-child { border: none; }

        .hidden { display: none !important; }
        #login-screen { position: fixed; inset: 0; background: white; z-index: 2000; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="login-screen">
    <div style="text-align:center; max-width:380px; width:100%; padding:30px; background:#fff; border-radius:30px; box-shadow: 0 20px 60px rgba(0,0,0,0.1);">
        <div style="background:var(--navy-header); width:80px; height:80px; border-radius:25px; display:flex; align-items:center; justify-content:center; margin:0 auto 25px; color:#fff;">
            <i class="fas fa-fingerprint fa-3x"></i>
        </div>
        <h2 style="margin-bottom:30px; color:var(--navy-header);">Smart Login</h2>
        <input type="password" id="pinInput" placeholder="ENTER ACCESS PIN" style="width:100%; padding:20px; border-radius:15px; border:2px solid #f0f0f0; text-align:center; font-size:1.7rem; outline:none; margin-bottom:25px; box-sizing:border-box; color:var(--navy-header);">
        <button onclick="handleLogin()" style="width:100%; padding:20px; border-radius:15px; background:var(--navy-header); color:white; border:none; font-weight:600; cursor:pointer; font-size:1.2rem; transition: 0.3s;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</button>
    </div>
</div>

<div id="main-interface" class="hidden">
    <header>
        <div class="h-left">Smart Control <span class="master-badge">Master</span></div>
        <div id="display-name" style="font-weight: 400; font-size: 1rem; opacity: 0.9;">ADMIN_USER</div>
        <button class="logout-btn" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </header>

    <div class="container">
        <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‡∏ó‡∏∏‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h2>

        <div id="gold-link-bar" class="executive-section hidden">
            <div class="gold-label"><i class="fas fa-crown"></i> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
            <a href="dashboard.html" class="btn-gold">
                <i class="fas fa-chart-line"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (Executive Dashboard)
            </a>
        </div>

        <button class="btn-add" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡∏°‡∏≤‡πÉ‡∏ô Phase ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏Ñ‡∏£‡∏±‡∏ö!')">
            <i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        </button>

        <div class="search-wrapper">
            <i class="fas fa-search" style="color:#aaa;"></i>
            <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ó‡∏≥‡πÄ‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á..." onkeyup="filterData()">
        </div>

        <div class="main-data-card">
            <div id="loader-box">
                <div class="loading-state">
                    <i class="fas fa-sync fa-spin fa-4x"></i>
                    <div style="font-size:1.3rem; font-weight:500; color:#333;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏´‡∏≤‡∏≠‡∏≥‡∏ô‡∏≤‡∏à...</div>
                </div>
            </div>
            <div id="property-list-ui" class="hidden"></div>
        </div>
    </div>
</div>

<script>
    // üîó URL Apps Script ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const apiURL = "https://script.google.com/macros/s/AKfycbxUduvVQ2oDjgJT3HJlGDzpbEav1_orj-G2UalilY27QoRtSgNOHPFdw7-NNYPdakA8/exec";
    let propertyCache = [];
    let userSession = null;

    async function handleLogin() {
        const pin = document.getElementById('pinInput').value;
        try {
            const res = await fetch(`${apiURL}?action=universalLogin&key=${pin}`).then(r => r.json());
            if (res.success) {
                userSession = res;
                localStorage.setItem('smart_auth', JSON.stringify(res));
                initUI();
            } else { alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á"); }
        } catch(e) { alert("‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß"); }
    }

    function initUI() {
        userSession = userSession || JSON.parse(localStorage.getItem('smart_auth'));
        if (!userSession) return;

        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('main-interface').classList.remove('hidden');
        document.getElementById('display-name').innerText = userSession.name;

        // üõ°Ô∏è ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å "‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏•‡∏±‡∏ö‡∏™‡∏µ‡∏ó‡∏≠‡∏á" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        if (String(userSession.role).toUpperCase().includes('SUPER')) {
            document.getElementById('gold-link-bar').classList.remove('hidden');
        }

        loadData();
    }

    async function loadData() {
        try {
            const res = await fetch(`${apiURL}?role=${userSession.role}&project=${userSession.project}`).then(r => r.json());
            propertyCache = res;
            document.getElementById('loader-box').classList.add('hidden');
            document.getElementById('property-list-ui').classList.remove('hidden');
            renderTable(propertyCache);
        } catch(e) { document.getElementById('loader-box').innerText = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ"; }
    }

    function renderTable(data) {
        const list = document.getElementById('property-list-ui');
        list.innerHTML = data.map(i => `
            <div class="property-row">
                <div>
                    <div style="font-weight:600; font-size:1.2rem; color:var(--navy-header);">${i.HP_ID} | ${i.ID}</div>
                    <div style="font-size:0.9rem; color:#666; margin-top:4px;">${i.District} | ${i.Status} | ‡∏ø${Number(i.Price).toLocaleString()}</div>
                </div>
                <div style="color:var(--action-blue); font-size:1.8rem; cursor:pointer;"><i class="fas fa-edit"></i></div>
            </div>
        `).join('');
    }

    function filterData() {
        const val = document.getElementById('searchInput').value.toLowerCase();
        const filtered = propertyCache.filter(p => p.HP_ID.toLowerCase().includes(val) || p.ID.toLowerCase().includes(val));
        renderTable(filtered);
    }

    function logout() { localStorage.clear(); location.reload(); }
    window.onload = () => { if(localStorage.getItem('smart_auth')) initUI(); };
</script>
</body>
</html>
