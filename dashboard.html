<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Dashboard - Smart System Capital</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a5276; --gold: #f1c40f; --green: #27ae60; --bg: #f4f7f6; --white: #ffffff; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; }
        .header { background: var(--primary); color: white; padding: 25px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .container { padding: 20px; max-width: 1200px; margin: 0 auto; }
        
        /* üí∞ Main KPI Cards */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: var(--white); padding: 30px; border-radius: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; transition: 0.3s; }
        .kpi-card:hover { transform: translateY(-5px); }
        .kpi-icon { font-size: 2.5rem; color: var(--primary); margin-bottom: 15px; }
        .kpi-value { font-size: 2rem; font-weight: 600; color: var(--primary); margin: 5px 0; }
        .kpi-label { font-size: 0.9rem; color: #7f8c8d; text-transform: uppercase; font-weight: 500; }

        /* üèòÔ∏è District Stats [Requested] */
        .district-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .district-card { background: #fff; padding: 20px; border-radius: 15px; display: flex; align-items: center; gap: 15px; border-left: 5px solid var(--primary); }
        .district-info h4 { margin: 0; font-size: 0.85rem; color: #7f8c8d; }
        .district-info div { font-size: 1.3rem; font-weight: 600; color: var(--primary); }

        .data-box { background: var(--white); padding: 30px; border-radius: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .data-title { font-weight: 600; color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; font-size: 1.2rem; }
        
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; background: #f8f9fa; color: var(--primary); border-radius: 10px; font-size: 0.9rem; }
        td { padding: 18px 15px; border-bottom: 1px solid #f1f1f1; font-size: 1rem; }
        
        .btn-back { display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px; text-decoration: none; color: var(--primary); font-weight: 600; background: #fff; padding: 10px 20px; border-radius: 50px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0;"><i class="fas fa-chart-pie"></i> EXECUTIVE SALES DASHBOARD</h2>
    <small>‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏ì‡∏≤‡∏à‡∏±‡∏Å‡∏£ Smart-Hua Hin Properties</small>
</div>

<div class="container">
    <a href="admin.html" class="btn-back"><i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏´‡∏•‡∏±‡∏Å</a>

    <div class="district-grid">
        <div class="district-card"><i class="fas fa-city fa-2x" style="color:#3498db"></i><div class="district-info"><h4>‡∏´‡∏±‡∏ß‡∏´‡∏¥‡∏ô (Hua Hin)</h4><div id="cnt-huahin">0 ‡∏´‡∏•‡∏±‡∏á</div></div></div>
        <div class="district-card"><i class="fas fa-umbrella-beach fa-2x" style="color:#e67e22"></i><div class="district-info"><h4>‡∏ä‡∏∞‡∏≠‡∏≥ (Cha-am)</h4><div id="cnt-chaam">0 ‡∏´‡∏•‡∏±‡∏á</div></div></div>
        <div class="district-card"><i class="fas fa-mountain fa-2x" style="color:#27ae60"></i><div class="district-info"><h4>‡∏õ‡∏£‡∏≤‡∏ì‡∏ö‡∏∏‡∏£‡∏µ (Pranburi)</h4><div id="cnt-pran">0 ‡∏´‡∏•‡∏±‡∏á</div></div></div>
        <div class="district-card" style="border-color: #9b59b6;"><i class="fas fa-globe fa-2x" style="color:#9b59b6"></i><div class="district-info"><h4>‡∏≠‡∏∑‡πà‡∏ô‡πÜ / ‡∏£‡∏ß‡∏°</h4><div id="cnt-total">0 ‡∏´‡∏•‡∏±‡∏á</div></div></div>
    </div>

    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-icon"><i class="fas fa-coins"></i></div>
            <div class="kpi-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏≠‡∏≤‡∏ì‡∏≤‡∏à‡∏±‡∏Å‡∏£</div>
            <div class="kpi-value" id="totalValue">‡∏ø0</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-icon" style="color: var(--green);"><i class="fas fa-handshake"></i></div>
            <div class="kpi-label">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ (SOLD)</div>
            <div class="kpi-value" id="totalSold" style="color: var(--green);">‡∏ø0</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-icon" style="color: var(--gold);"><i class="fas fa-piggy-bank"></i></div>
            <div class="kpi-label">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡∏ô‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°</div>
            <div class="kpi-value" id="totalComm" style="color: var(--gold);">‡∏ø0</div>
        </div>
    </div>

    <div class="data-box">
        <div class="data-title"><i class="fas fa-list-ul"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</div>
        <div id="tableContent">
            <div style="text-align:center; padding:50px;"><i class="fas fa-sync fa-spin fa-2x"></i></div>
        </div>
    </div>
</div>

<script>
    // üöÄ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô URL ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy ‡∏Ñ‡∏£‡∏±‡∏ö
    const api = "https://script.google.com/macros/s/AKfycbx0ICTtHVgCCIU48VQFb-6tO9yvKgD6_oOBIN31tBYB3oHQ3h2JTS_ZIU0JyGG2O-jc/exec";
    
    const user = JSON.parse(localStorage.getItem('smartAdmin'));
    if(!user || user.role !== 'Master') {
        alert("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢! ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏î‡πâ");
        window.location.href = 'admin.html';
    }

    async function loadDashboard() {
        try {
            const res = await fetch(`${api}?action=salesSummary`);
            const d = await res.json();

            // 1. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡πâ‡∏≤‡∏ô [Requested]
            document.getElementById('cnt-huahin').innerText = `${d.districtStats["Hua Hin"]} ‡∏´‡∏•‡∏±‡∏á`;
            document.getElementById('cnt-chaam').innerText = `${d.districtStats["Cha-am"]} ‡∏´‡∏•‡∏±‡∏á`;
            document.getElementById('cnt-pran').innerText = `${d.districtStats["Pranburi"]} ‡∏´‡∏•‡∏±‡∏á`;
            document.getElementById('cnt-total').innerText = `${d.totalProperties} ‡∏´‡∏•‡∏±‡∏á`;

            // 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (Fixed NaNM)
            document.getElementById('totalValue').innerText = `‡∏ø${(d.totalValue/1000000).toFixed(2)}M`;
            document.getElementById('totalSold').innerText = `‡∏ø${(d.totalSoldValue/1000000).toFixed(2)}M`;
            document.getElementById('totalComm').innerText = `‡∏ø${d.totalCommission.toLocaleString()}`;

            // 3. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
            let html = `<table><thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</th><th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°</th><th>‡∏Å‡∏≥‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á</th></tr></thead><tbody>`;
            for (const [name, info] of Object.entries(d.projectBreakdown)) {
                html += `<tr>
                    <td><b>${name}</b></td>
                    <td>${info.count} ‡∏´‡∏•‡∏±‡∏á</td>
                    <td>‡∏ø${Number(info.value).toLocaleString()}</td>
                    <td style="color:var(--green); font-weight:600;">‡∏ø${Number(info.comm).toLocaleString()}</td>
                </tr>`;
            }
            html += `</tbody></table>`;
            document.getElementById('tableContent').innerHTML = html;

        } catch (e) {
            document.getElementById('tableContent').innerHTML = `<div style="color:red; text-align:center;">‚ùå ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>`;
        }
    }

    loadDashboard();
</script>
</body>
</html>
